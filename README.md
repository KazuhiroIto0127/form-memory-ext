# Form Memory Chrome Extension

> Save your keystrokes, focus on your work.

---

## 目的

SaaS や社内 Web アプリの **同一フォームに何度も同じ内容を入力する作業** を自動化し、入力ミスの削減と業務効率の向上を図ることを目的とした Chrome 拡張機能です。

## 主な機能

| 機能                       | 説明                                                                                                                           |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **フォーム入力内容の保存** | ユーザーが Web フォームに入力した値をローカル ( `chrome.storage.sync` ) に保存します。                                         |
| **保存サジェスト UI**      | ページに `<form>` 要素が存在し、入力が検出された際に「このフォームを保存しますか？」というフローティング UI を自動表示します。 |
| **自動再入力**             | 次回同じ URL (origin + path) でページを開いたとき、保存済みデータを検出してフォームに自動で値を挿入します。                    |
| **ファイル入力除外**       | `input[type="file"]` はセキュリティ仕様上、ブラウザが値を読み取れないため対象外とします。                                      |
| **オプション画面**         | 保存済みフォーム一覧の閲覧・削除、無効化 URL の設定が可能です。                                                                |

## ユースケース

- 請求書発行 SaaS に毎月同じ会社情報を入力する
- 社内ワークフローの経費精算フォームに繰り返し同じ部署名や担当者名を入力する

## システム構成

```
+-------------------+      +--------------------------+
| Content Script    | <--->| Background ServiceWorker |
| - フォーム検知     |      | - データ永続化           |
| - 値挿入           |      | - ポップアップ通信       |
+-------------------+      +--------------------------+
        |                             |
        v                             v
    +--------------+            +----------------+
    | Suggest UI   |            | Options Page   |
    +--------------+            +----------------+
```

### 技術スタック

- Chrome **Manifest V3**
- TypeScript + Vite
- UI: Lit (軽量 Web Components) / Tailwind CSS

## 保存ロジック概要

1. フォームが表示されたら `input`, `textarea`, `select` の `change` / `input` イベントを監視。
2. いずれかに入力が行われたら **未保存** 状態としてフラグを立てる。
3. ユーザーが一定時間入力を停止、または `submit` 直前でフローティング UI を表示。
4. **[保存する]** を押すと、`{ key: <origin+path+formIndex>, data: { fieldName: value } }` を `chrome.storage.sync` に永続化。
5. 再訪時、同一キーが存在すれば各フィールドに `value` / `checked` を設定。

## 権限 (manifest.json)

```json
{
  "permissions": ["storage", "activeTab"],
  "host_permissions": ["<all_urls>"]
}
```

## 除外 & 制限事項

- `input[type="file"]` はブラウザ仕様により **値の読み取り・再設定が不可能** です。
- クロスオリジン iframe 内のフォームは、`all_frames` 設定を有効にしても同一オリジンでなければアクセスできません。
- `chrome.storage.sync` には 100 KB/アイテム、8 MB/拡張あたりのクォータがあります。大量データを扱う場合は `chrome.storage.local` へのフォールバックを検討してください。
- Chrome が提供する既存のオートフィル機能や他パスワードマネージャー拡張と競合する可能性があります。

## セキュリティ & プライバシー

- データは **ローカルブラウザ内** のみに保存し、外部サーバーへ送信しません。
- HTTPS ページから HTTP ページへのデータ注入を防ぐため、保存時のスキーマを含めた URL マッチで検証します。
- オプション画面で URL ごとの保存/自動入力をオフにできます。

## 開発手順

```bash
# 1. リポジトリを取得
$ git clone <repo-url> form-memory-ext
$ cd form-memory-ext

# 2. 依存関係をインストール
$ npm install

# 3. ビルド (dist/ に出力)
$ npm run build

# 4. Chrome で読み込み
  - chrome://extensions を開く
  - デベロッパーモードを ON
  - 「パッケージ化されていない拡張機能を読み込む」→ dist/ を選択
```

## よくある質問 (FAQ)

| 質問                                   | 回答                                                                                                             |
| -------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| パスワード入力も保存できますか？       | 技術的には可能ですが、セキュリティ観点から **デフォルト無効** とし、オプションで個別に有効化できるようにします。 |
| 他ブラウザで同期できますか？           | `chrome.storage.sync` は同じ Google アカウントの Chrome 間で同期されます。Edge/Firefox には対応していません。    |
| ファイル入力は本当に保存できませんか？ | はい。ブラウザは `input[type=file].value` を常に空文字にします。仕様レベルで禁止されているため不可能です。       |

## ライセンス

MIT

